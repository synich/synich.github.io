<!doctype html><html lang=zh-ch>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>网络相关头文件所属目录的关系 | 蛙二的思考</title>
<meta property="og:title" content="网络相关头文件所属目录的关系 - 蛙二的思考">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-05-25T12:00:00+08:00">
<meta property="article:modified_time" content="2017-05-25T12:00:00+08:00">
<meta name=Keywords content>
<meta name=description content="网络相关头文件所属目录的关系">
<meta name=author content>
<meta property="og:url" content="/post/170525/">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=stylesheet href=/css/normalize.css>
<link rel=stylesheet href=/css/style.css>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
</head>
<body>
<header id=header class=clearfix>
<div class=container>
<div class=col-group>
<div class=site-name>
<a id=logo href>
蛙二的思考
</a>
</div>
<div>
<nav id=nav-menu class=clearfix>
<a class=current href>首页</a>
</nav>
</div>
</div>
</div>
</header>
<div id=body>
<div class=container>
<div class=col-group>
<div class=col-8 id=main>
<div class=res-cons>
<article class=post>
<header>
<h1 class=post-title>网络相关头文件所属目录的关系</h1>
</header>
<date class="post-meta meta-date">
2017年5月25日
</date>
<div class=post-content>
<p>unix下的网络文件分布的目录比较多，初看会觉得很乱且难记，试着整理一下。</p>
<p>本着unix下一切皆文件，所有的网络操作都通过抽象的socket操作，即socket是这些网络的承载者，不同的网络主机有各自的socket，并处在不同地址上。socket的头文件是sys/socket.h，比较直观也很好记。</p>
<p>对网络来说，不同的网络不能直接通信，所以socket首先要和地址绑定，不同的网络方式地址格式不同，要确定地址就要先确定网络方式，这里引入第一个概念<code>AF_XXX</code>宏，AF指Address Family，除了常见的IP网络(有<code>AF_INET/AF_INET6</code>两种)，还有像Bluetooth、AppleTalk、IPX(Novell)等不常见格式。OpenBSD支持36种，而Linux支持40种。从数量来看好像差不多，但两个系统间互相之间的交集并不多。Linux支持的NFC/CAN格式在BSD下不存在，同样BSD也有很多Linux没有的，不过总的来看BSD的网络协议更冷门一点，也许和它历史更久，用得也少有关系。</p>
<p>因为不同的地址族使用不同的协议，所以还定义了一套<code>PF_XXX</code>的宏，PF指Protocol Family，除了前缀不同，其它和AF宏完全一样。既然有三十多种地址，地址的格式必然不会相同，struct sockaddr解决的就是这个问题，这是个变长的结构，否则无法支持未来的网络协议族，因此这个结构最重要的就是长度和family字段，定义方式和TLV的思想是一致的。sockaddr相当于父类，具体每种协议族有各自的表示，像<code>sockaddr_in</code>是IP网络地址，而appletalk就是<code>sockaddr_at</code>，命名风格非常统一。不过并不是每个协议族都有专用地址，net80211/就没有。</p>
<p>虽然socket.h文件比较长，但和操作相关的accept/bind/connet/listen等占比重不高，其余大量各种宏和数据结构操作的定义。比如<code>SOCK_STREAM/SOCK_DGRAM</code>，这样看起来，这两个定义适合各种网络，而不仅仅是TCP/UDP。</p>
<p>理解了socket.h，就能知道网络的family有非常多，每种family下肯定还有很多的选项，这么多的协议族肯定要分开保存管理，所以在/usr/include/目录下有net/目录，还有形如netinet/、netmpls/、netatalk/、netax25/等等具体协议族的目录。</p>
<p>先说net/目录，这下面的文件特点是大都<code>if_xxx.h</code>风格，主要的用途是查询(inquery)各种network interface。比如<code>IFF_UP/IFF_MULTICAST</code>操作。BSD和Linux在这里又显出很大的差别，BSD中定义了名为ifnet的结构，用于内核操作网络接口man(9)，但Linux没有。</p>
<p>net的作用更多在于操作网卡，具体的协议比如IP协议则定义在netinet/目录下，这里的in.h(我猜应该in是internet的简写)定义了IP协议的各种应用，如TCP/UDP/ICMP/IGMP/ESP/AH等。这些定义都以<code>IPPROTO_</code>作为前缀，是IP PROTOCOL的简写。</p>
<p>这样一路看下来，网络头文件的规律就很清晰了。最后再说一个稍有点特殊的头文件，arpa/inet.h，这里定义了各种IP地址的数字表示和字符串表示的转换函数，为什么放在arpa目录，我猜是因为：IP网络的定义是由IEEE提出的，但第一个实现这个网络的是arpanet(1968年构想，直到1975年才有60个节点)，可能是当时开发时觉得，需要一个工具性质的地址转换函数，就放在arpa这个有点项目专用性质的目录下了，但后来随着用的人很多，所以就保留至今，没有移到netinet目录。另外arpa/目录下还有telnet.h/ftp.h/tftp.h等文件，原因是arpanet要求主机实现telnet/ftp/tftp协议，这也是一个网络最基本且必须的功能。所以arpa/目录作为历史的见证一直保留到今天。</p>
</div>
<div class="post-meta meta-tags">
没有标签
</div>
</article>
</div>
<footer id=footer>
<div>
&copy; 2021 <a href>蛙二的思考 By </a>
</div>
<br>
<div>
<div class=github-badge>
<a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
</div>
<div class=github-badge>
<a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">蛙二</span></a>
</div>
<div class=github-badge>
<a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
</div>
</div>
</footer>
<script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script>
</div>
<div id=secondary>
<section class=widget>
<form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1>
<input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch>
<button type=submit class="submit icon-search"></button>
</form>
</section>
<section class=widget>
<h3 class=widget-title>最近文章</h3>
<ul class=widget-list>
<li>
<a href=/post/210901/ title=对昼伏夜出和朝九晚五两个技战法的分析>对昼伏夜出和朝九晚五两个技战法的分析</a>
</li>
<li>
<a href=/post/210729/ title=git的远程访问辨析>git的远程访问辨析</a>
</li>
<li>
<a href=/post/210721/ title=PySpark分析>PySpark分析</a>
</li>
<li>
<a href=/post/210614/ title=erlang和其上的扩展语言>erlang和其上的扩展语言</a>
</li>
<li>
<a href=/post/210613/ title=lisp编程与结构化思想>lisp编程与结构化思想</a>
</li>
<li>
<a href=/post/210611/ title=理解shell的换行和打印>理解shell的换行和打印</a>
</li>
<li>
<a href=/post/210421/ title=vim的自定义扩展>vim的自定义扩展</a>
</li>
<li>
<a href=/post/210404/ title=数据库的执行优化>数据库的执行优化</a>
</li>
<li>
<a href=/post/210322/ title=对公有云上数仓的调研>对公有云上数仓的调研</a>
</li>
<li>
<a href=/post/210216/ title=hadoop体系理解>hadoop体系理解</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/categories/>分类</a></h3>
<ul class=widget-list>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/tags/>标签</a></h3>
<div class=tagcloud>
</div>
</section>
<section class=widget>
<h3 class=widget-title>其它</h3>
<ul class=widget-list>
<li><a href=index.xml>文章 RSS</a></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</body>
</html>