<!doctype html><html lang=zh-ch><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>网络文件系统机制 | 蛙二的思考</title><meta property="og:title" content="网络文件系统机制 - 蛙二的思考"><meta property="og:type" content="article"><meta property="article:published_time" content="2019-04-29T12:00:00+08:00"><meta property="article:modified_time" content="2019-04-29T12:00:00+08:00"><meta name=Keywords content><meta name=description content="网络文件系统机制"><meta name=author content><meta property="og:url" content="/post/190429/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href>蛙二的思考</a></div><div><nav id=nav-menu class=clearfix><a class=current href>首页</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>网络文件系统机制</h1></header><date class="post-meta meta-date">2019年4月29日</date><div class=post-content><p>几种常见的NAS协议，FTP无法挂载到路径，AFS只有Apple用，几乎遇不到，说说Samba(smb又叫CIFS)和nfs方式</p><h2 id=samba>Samba</h2><p>有1和2两个版本，在win10上比较方便，但win7怎么都试不出来。win10要用smb版本2，需要注意。
命令是sudo mount -t cifs -o username=&ldquo;administrator&rdquo;,password=&ldquo;1&rdquo; //winip/code/ /mnt/win -o vers=2.0</p><h2 id=nfs>nfs</h2><p>有1~4版本，前3个版本是Sun设计，而4是IETF主导，机制上改动很大。目前多见的是3和4版本，v3监听UDP的111端口，但真正RPC通信端口是后续协商出来的，而v4则只监听TCP/UDP的2049，配置防火墙更简单。</p><p>window作为服务端，linux作客户端时，高版本windows带了v4版本，或者用第三方hane nfs server开启服务，配置 <code>D:\code -public</code>就可以共享指定目录了。linux端下载nfs-utils。用 showmount -e ip 查看开放的共享目录，用 sudo mount -t nfs ip:/d/code /mnt/win 就可以挂载目录了。默认用UDP可能不太稳定，可以在mount加上 -o proto=tcp -o nolock。如果用v4版，mount命令改为-t nfs4。</p><p>如果linux作服务端，步骤稍多一些，必须root身份</p><ol><li>安装nfs-utils和rpcbind（也叫portmap）</li><li>编辑/etc/exports文件，exportfs -r 把目录写入内核</li><li>启动rpcbind，也叫portmapper服务，在cent上的包叫rpcbind</li><li>启动rpc.mountd和rpc.nfsd服务</li></ol><p>v3和v4版本都要用 exportfs 命令设置 NFS 导出目录。exportfs 有两种操作模式：</p><ol><li>读取 /etc/exports 以及 /etc/exports.d/*</li><li>从命令行参数获得导出目录设置</li></ol><p>两种模式下，exportfs 都会通过 /proc/net/rpc/nfsd.export/channel 往 Linux 内核写一份（很像 Plan 9 ），并且更新 /var/lib/nfs/etab 文件。</p><p>nfs采用了 C/S 架构，但是NFS的Client/Server只负责和文件系统交互，而不提供任何 TCP/IP 数据传输功能，需要配合RPC服务器才能实现数据传输（其实也好理解，Sun利用RPC开发了很多服务，NFS只是其中的一个应用，从分层角度看，自然不会包含网络协议）。因此nfs的v3版共有4个服务才能完成完整的功能</p><ol><li>rpcbind服务(portmapper)，监听111端口，有点像 DNS server，它把 PROGRAM ID 翻译成服务真正的 IP 和 PORT(不知道 IP 是否可以是其它机器），每个 RPC service 启动时都要向 注册自己的 PROGRAM ID。可以用rpcinfo -p ip来查看注册了哪些服务。注意这个命令是查注册命令，不一定运行，所以netstat可能看不到这些端口</li><li>rpc.mountd服务，监听20048端口，应该是负责文件系统交互的服务</li><li>rpc.statd服务，有IN和OUT端口要监听</li><li>rpc.nfsd服务，监听2049端口，如果没启动，客户端在mount时会提示RPC程序未注册</li></ol><p>v4版简化了上述流程，只需要nfsd监听2049就可以了，简化了防火墙的配置难度，但需要额外向/proc/fs/写内容。</p></div><div class="post-meta meta-tags">没有标签</div></article></div><footer id=footer><div>&copy; 2022 <a href>蛙二的思考 By</a></div><br><div><div class=github-badge><a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a></div><div class=github-badge><a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">蛙二</span></a></div><div class=github-badge><a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a></div></div></footer><script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[["$","$"]],processEscapes:!0}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list><li><a href=/post/220421/ title=数据引擎和算子对比>数据引擎和算子对比</a></li><li><a href=/post/220405/ title=Kubernetes初学笔记>Kubernetes初学笔记</a></li><li><a href=/post/220312/ title=分布式计算在Spark上的实现>分布式计算在Spark上的实现</a></li><li><a href=/post/220204/ title=分布式哈希技术摘录>分布式哈希技术摘录</a></li><li><a href=/post/220201/ title=压缩技术浅谈>压缩技术浅谈</a></li><li><a href=/post/220115/ title=Python的数据科学相关库介绍>Python的数据科学相关库介绍</a></li><li><a href=/post/211226/ title=SU的执行过程与用户登陆机制>SU的执行过程与用户登陆机制</a></li><li><a href=/post/211222/ title=SQL的JOIN种类与选择>SQL的JOIN种类与选择</a></li><li><a href=/post/211218/ title=内存使用的观察和理解>内存使用的观察和理解</a></li><li><a href=/post/211115/ title=搭建最小化的Linux系统>搭建最小化的Linux系统</a></li></ul></section><section class=widget><h3 class=widget-title><a href=/categories/>分类</a></h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title><a href=/tags/>标签</a></h3><div class=tagcloud></div></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=index.xml>文章 RSS</a></li></ul></section></div></div></div></div></body></html>