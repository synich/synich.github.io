<!doctype html>
<html lang="zh-ch">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>从ifconfig接口看网卡 | 蛙二的思考</title>
    <meta property="og:title" content="从ifconfig接口看网卡 - 蛙二的思考">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2017-05-26T12:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2017-05-26T12:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="从ifconfig接口看网卡">
        
    <meta name="author" content="">
    <meta property="og:url" content="/post/170526/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="">
                        蛙二的思考
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">从ifconfig接口看网卡</h1>
        </header>
        <date class="post-meta meta-date">
            2017年5月26日
        </date>
        
        
        
        <div class="post-content">
            <h2 id="网络工具包的变迁">网络工具包的变迁</h2>
<p>ifconfig/route/netstat/arp/rarp等网络管理经典软件（属于net-tools包），起源于BSD TCP/IP工具箱，旨在配置老式Linux内核的网络功能。自2001年以后，它在Linux社区的发展就止步不前，很多发行版默认不安装该包，甚至有弃用net-tools的打算，改而使用iproute2替代。net-tools通过procfs(/proc)和ioctl系统调用去访问和改变内核网络配置，而iproute2则通过netlink协议与内核通讯（这套协议和unix域套接字、inet在同一层级）。由于netlink是Linux独有，BSD社区依然使用net-tools工具。</p>
<p>ip命令比ifconfig显示的网卡数量多一些，ip能显示的网卡，都在/proc/net/dev里保存着。</p>
<p>介绍几个可能不那么常见的标志含义</p>
<ul>
<li>LOWER_UP：注释表明Driver signals L1 up (since Linux 2.6.17)，是物理层的标志。LOWER_UP表示以太网线已插入，并且设备接入到网络。而UP在LOWER_UP的基础上，还要求网卡使能（个人理解是被ifup）。</li>
<li>NO-CARRIER：可以和UP一起，但表示网络不通。可能的原因有：网线故障、无线未在SSID认证、驱动故障（极少数）。</li>
<li>NOARP：对于BORADCAST型网络（以太网或无线电packet radio），ARP标志默认打开，如果显示NOARP则表示ARP被禁用，可能是网络形态不同，也可能确实遇到故障。</li>
</ul>
<p>ifconfig会显示发送和收到的包数据，单位多见MiB，这个单位表示2^20，在1998年12月定义的ISO/IEC80000规范里可查，同一家族有kibi, mebi, gibi, tebi, pebi, exbi, zebi, yobi，i取自binary的第2个字母，所以这些单位都用bi后缀。而平时常见的MB往往会视场景，可能是10^6，也可能是2^20。以精确而言，MiB是更好的写法。</p>
<p>RX和TX的包数据里，会另外显示5种异常状态的数据（frame和carrier是单向）</p>
<ul>
<li>Errors: The total number of transmit or receive errors detected by the device driver.</li>
<li>Dropped: The total number of packets dropped by the device driver.</li>
<li>Overruns: 驱动拿到的包，会放到内核的Ring Buffer（FIFO队列），如果网络流量过大超过CPU处理速度，就会导致overrun。ethtool -g查看，ethtool -G修改参数。</li>
<li>Frame: 收包特有，一般表示收到的帧过小或过大，比如不符合8bit的帧。</li>
<li>Carrier: 发包特有，carrier原意是调制用的载波，此处表示因载波异常或不匹配导致数据发不出去。</li>
</ul>
<h2 id="linux与bsd的网卡差异">Linux与BSD的网卡差异</h2>
<p>Linux下的网卡只有lo和eth两张，但是OpenBSD还额外多两张虚拟网卡，enc和pflog。这两张网卡都是基于pf而存在，因此也就好理解为什么是OpenBSD特有的网卡。</p>
<p>enc和ipsec特性配套，pflog则是pf log的简写。IPSec有四大特点：</p>
<ol>
<li>数据加密</li>
<li>内容完整</li>
<li>身份认证</li>
<li>防重放攻击</li>
</ol>
<p>IPSec有两个协议族，ESP(Encapsulating Security Payload)和AH(Authentication Header)，差异在于</p>
<ul>
<li>ESP具备以上四条特性，但只对IP的负载生效，不保证IP头的安全</li>
<li>AH重心在认证，因此缺少数据加密功能，但它能保护IP头</li>
</ul>
<p>如果要让socket启用IPSec，OpenBSD的netinet/in.h下定义了很多IPSec的宏，如<code>IP_AUTH_LEVEL/IP_ESP_TRANS_LEVEL/IP_ESP_NETWORK_LEVEL</code>以及<code>IPSEC_</code>开头的很多宏，可惜这些并不跨平台，Linux系统定义在linux/ipsec.h中，且是通过枚举方式，数量也没有OpenBSD详细。</p>
<p>从默认网卡的配置和头文件定义就能看出，OpenBSD的确是在践行着最安全操作系统的理念。</p>
<h2 id="bond网卡制作">bond网卡制作</h2>
<p>服务器通常有多张网卡，要求配置为bond模式，对cent系来说，并不用特殊的命令，只要添加一个ifcfg-bond0的纯文本文件，重新启动网络服务就好。</p>
<p>展开了说，bond是由普通eth网卡组成，同时修改那几个ifcfg-eth的文本，使它们映射到bond，而所有的IP，网关，掩码都在bond配置。似乎还要启动一个内核模块，具体原因不明。</p>

        </div>

        


        


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="">蛙二的思考 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">蛙二</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>







                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='//www.google.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="/post/210901/" title="对昼伏夜出和朝九晚五两个技战法的分析">对昼伏夜出和朝九晚五两个技战法的分析</a>
    </li>
    
    <li>
        <a href="/post/210729/" title="git的远程访问辨析">git的远程访问辨析</a>
    </li>
    
    <li>
        <a href="/post/210721/" title="PySpark分析">PySpark分析</a>
    </li>
    
    <li>
        <a href="/post/210614/" title="erlang和其上的扩展语言">erlang和其上的扩展语言</a>
    </li>
    
    <li>
        <a href="/post/210613/" title="lisp编程与结构化思想">lisp编程与结构化思想</a>
    </li>
    
    <li>
        <a href="/post/210611/" title="理解shell的换行和打印">理解shell的换行和打印</a>
    </li>
    
    <li>
        <a href="/post/210421/" title="vim的自定义扩展">vim的自定义扩展</a>
    </li>
    
    <li>
        <a href="/post/210404/" title="数据库的执行优化">数据库的执行优化</a>
    </li>
    
    <li>
        <a href="/post/210322/" title="对公有云上数仓的调研">对公有云上数仓的调研</a>
    </li>
    
    <li>
        <a href="/post/210216/" title="hadoop体系理解">hadoop体系理解</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>