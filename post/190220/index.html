<!doctype html>
<html lang="zh-ch">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <title>程序语言的依赖包管理 | 蛙二的思考</title>
    <meta property="og:title" content="程序语言的依赖包管理 - 蛙二的思考">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2019-02-20T12:00:00&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2019-02-20T12:00:00&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="程序语言的依赖包管理">
        
    <meta name="author" content="">
    <meta property="og:url" content="/post/190220/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="">
                        蛙二的思考
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">程序语言的依赖包管理</h1>
        </header>
        <date class="post-meta meta-date">
            2019年2月20日
        </date>
        
        
        
        <div class="post-content">
            <p>没有人可以写从到尾写完一个程序，除了内核这种项目，多都需要依赖其它库或源码，解决依赖也成了各种语言的基本功。又细分了两个需求：全局的包管理和项目级的包管理，不同的语言支持程度各不相同。</p>
<h2 id="js">JS</h2>
<p>npm是Node.js的首选模块依赖管理工具，仓库npm config get/set registry修改成国内的镜像http://registry.npm.taobao.org/。有本地和全局两种安装模式。</p>
<ul>
<li>本地模式</li>
</ul>
<p>在当前目录创建 package.json 文件来描述模块的依赖，在这个文件里你可以定义你的应用名称( name )、应用描述( description )、关键字( keywords )、版本号( version )等。npm会下载当前项目依赖模块到项目中一个叫做node_modules的文件夹内。</p>
<ul>
<li>全局模式</li>
</ul>
<p>惟一的区别就是 install 命令后多了 -g 选项。安装到 prefix 目录的node_modules文件夹。但有一点不同，全局安装的依赖在主入口目录内，而本地则是平铺开。举个例子</p>
<p>npm的2.x版本采用嵌套式依赖方案，适合某个依赖在一个项目中多版本并存的问题，比如node；而3.x则换成扁平化的方式，更适合前端。npm的依赖可以指定版本区间，锁定，任意版本都支持。</p>
<p>安装A库，A依赖B。如果是本地安装，node_modules下有 A 和 B 两个目录。但是如果是全局安装，node_modules只有A目录，A目录内又有node_modules，在这个嵌套子目录内会有B目录。</p>
<p>对node来说，require的参数如果是核心模块，不会搜索磁盘目录直接加载核心模块，如果不在核心列表内，就会在路径后依次用找package.json的main字段/.js/.json/.node方式寻找，找到第一个文件停止搜索，且npm还有缓存机制，如果在缓存中就不会重复加载。</p>
<p>与maven/gradle不同的是，maven最终会分析依赖树，把相同的软件默认扁平化取最高版本。而npm支持nested dependency tree。nested dependency tree是每个模块依赖自己目录下node_modules中的模块，这样能避免了依赖冲突, 但耗费了更多的空间和时间。由于Javascript是源码发布，所以开发态与运行态的依赖都是基于npm，优先从自己的node_modules搜索依赖的模块。</p>
<h2 id="lua">Lua</h2>
<p>rocks安装时要指定属于全局、个人或项目。</p>
<h2 id="python">Python</h2>
<p>pip只有全局模式，不支持项目级别定制包。默认放在python的lib/site-package目录，两个目录或是一个文件加一个目录（一个是执行模块或包，一个是描述元数据）。比如安装jedi包，成功后会有一个名为jedi的目录，还有一个jedi-0.16.0.dist-info目录。jedi目录放py代码，而带版本号的目录则放requires.txt、SOURCE.txt、PKG-INFO等元数据文件，依赖关系就记录在requires.txt里。将这两个文件以zip方式压缩，就是wheel包。</p>
<h2 id="php">PHP</h2>
<p>出现较早的pear只支持全局下载包，后出现composer称自己是依赖管理器（也支持pear的包模式），可以在全局或项目中管理包更新，另外还自带PSR4的加载规范。</p>
<h2 id="java">Java</h2>
<p>没有全局包的概念，只能在项目层面用pom.xml来控制版本，指定的版本号必须精确匹配，又走到了另一个极端。如果仓库没有想要的版本，就失败了不能模糊匹配。</p>
<p>开发态，可以通过maven和gradle工具编辑依赖清单列表/脚本，指定依赖库的位置/版本等信息，这些可以帮助你在合适的时间将项目固化到一个可随时随地重复编译发布的状态。这些工具对我来说已经足够优雅有效。但maven中也有不同依赖库的内部依赖版本冲突等令人心烦的问题。尤其是在大型项目中的依赖传递问题，若团队成员对maven机制没有足够了解下，依赖scope的滥用，会让整个项目工程的依赖树变得特别的巨大而每次编译效率低下。运行态，目前Java也没有很好的依赖管理机制，虽有classloader可以做一定的隔离，但像OSGi那种严格的版本管理，会让使用者陷入多版本相互冲突的泥潭。</p>
<p>展开说说maven，可以理解为Makefile的网络版，得益于java原生的网络支持，远程仓库的jar包和本地/lib下的so在软件层面等效。lifecycle由多个阶段(插件)构成，类似的也有clean, test, compile等目标，不同的是只能输出一种目标，package输出到当前工程，install进一步写入本地仓库，可以给其它工程链接，deploy多一步发布到远程仓库，给其他人用。</p>
<h2 id="c语言">C语言</h2>
<p>最多的还是Makefile，但和其它语言比，只能说是半残。接口头文件和库之间没法校验匹配性，也不容易指定库的版本。链接时通常是指定库名称，到底指向哪个库，只能听由操作系统的软链接。所以现在的发行版在.so后面还会跟一个数字，形成类似.so.2这样的文件名，如果出现重大不兼容，可以指定大版本。</p>
<h2 id="语义化semver">语义化semver</h2>
<p>开源产品的迭代难免引入不兼容修改，通过目前社区都认同的语义化版本方案，依赖时必须要限定版本号，否则大版本升级就无可挽回了。npm有<code>~</code>和<code>^</code>两种标识符，比较体现版本依赖的思想。</p>
<ul>
<li><code>~</code>，tilde range。只接收bugfix，不会改功能版本，可以理解为约等号。比如<code>~1.2.0</code>，即使上游开发了1.3或1.4，仍停留在1.2.z的最后一个版本。是早期npm的默认策略，也是比较稳健的策略。</li>
<li><code>^</code>，caret range。只要保证兼容性，尽量往新了更，会保证左侧第一个非零值不动。比如<code>^1.2.0</code>会追踪上游的1.3.x，但是<code>^0.2.0</code>则会停留在0.2.x，因为左侧第一个非零是2，必须保证不变。这大概是语义化版本对0的理解有不稳定的意思，所以稳妥起见遇到0选择跳过。</li>
</ul>
<p>我倒觉得都用<code>1.*</code>这种方式表达依赖，更少学习成本，也更直观。</p>

        </div>

        


        


        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    
    

    
    
</div>

                    <footer id="footer">
    <div>
        &copy; 2021 <a href="">蛙二的思考 By </a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">蛙二</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>







                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='//www.google.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="/post/210901/" title="对昼伏夜出和朝九晚五两个技战法的分析">对昼伏夜出和朝九晚五两个技战法的分析</a>
    </li>
    
    <li>
        <a href="/post/210729/" title="git的远程访问辨析">git的远程访问辨析</a>
    </li>
    
    <li>
        <a href="/post/210721/" title="PySpark分析">PySpark分析</a>
    </li>
    
    <li>
        <a href="/post/210614/" title="erlang和其上的扩展语言">erlang和其上的扩展语言</a>
    </li>
    
    <li>
        <a href="/post/210613/" title="lisp编程与结构化思想">lisp编程与结构化思想</a>
    </li>
    
    <li>
        <a href="/post/210611/" title="理解shell的换行和打印">理解shell的换行和打印</a>
    </li>
    
    <li>
        <a href="/post/210421/" title="vim的自定义扩展">vim的自定义扩展</a>
    </li>
    
    <li>
        <a href="/post/210404/" title="数据库的执行优化">数据库的执行优化</a>
    </li>
    
    <li>
        <a href="/post/210322/" title="对公有云上数仓的调研">对公有云上数仓的调研</a>
    </li>
    
    <li>
        <a href="/post/210216/" title="hadoop体系理解">hadoop体系理解</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>