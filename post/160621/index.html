<!doctype html><html lang=zh-ch>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>我理解的面向对象设计原则 | 蛙二的思考</title>
<meta property="og:title" content="我理解的面向对象设计原则 - 蛙二的思考">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-06-21T12:00:00+08:00">
<meta property="article:modified_time" content="2016-06-21T12:00:00+08:00">
<meta name=Keywords content>
<meta name=description content="我理解的面向对象设计原则">
<meta name=author content>
<meta property="og:url" content="/post/160621/">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=stylesheet href=/css/normalize.css>
<link rel=stylesheet href=/css/style.css>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
</head>
<body>
<header id=header class=clearfix>
<div class=container>
<div class=col-group>
<div class=site-name>
<a id=logo href>
蛙二的思考
</a>
</div>
<div>
<nav id=nav-menu class=clearfix>
<a class=current href>首页</a>
</nav>
</div>
</div>
</div>
</header>
<div id=body>
<div class=container>
<div class=col-group>
<div class=col-8 id=main>
<div class=res-cons>
<article class=post>
<header>
<h1 class=post-title>我理解的面向对象设计原则</h1>
</header>
<date class="post-meta meta-date">
2016年6月21日
</date>
<div class=post-content>
<p>面向对象的程序设计和面向对象的程序语言，两者并不完全一样。
面向对象的程序设计是一系列原则，是指导思想；而面向对象的语言，
则是把这些原则和思想，用一些规范化的语法给规定下来。</p>
<p>初学面向对象时，教科书都会提三大概念：封装、继承、多态。
但是我的理解，这里面只有多态才是面向对象的核心观念，
继承分接口继承和实现继承，接口继承勉强算是，实现继承则不算。
而封装更是和面向对象关系不大。</p>
<h2 id=面向对象设计的几条重要设计原则>面向对象设计的几条重要设计原则</h2>
<ul>
<li>开闭原则(Open-Close-Principle)</li>
<li>里氏替换原则(Liskov Substitution Principle)</li>
<li>依赖倒置原则(Dependence Inversion Principle)</li>
</ul>
<p>除了这三条还有许多，但我觉得这些就够了。这其中最原则性的，
就是开闭原则。即<strong>软件要对扩展开放，对修改封闭</strong>。我对这句话的
解读是：<strong>当你修改了代码并替换后，其它的使用者是感知不到的。</strong>
上面这个例子中的开放，就是对代码做修改；而封闭，就是使用者感知不到。
在《松本行弘的程序世界》和陈天的《谈谈编程思想》中，也都认为
OCP是最根本、最基础的原则。</p>
<p>从刚才的说明来看，就是在交互的双方之间，要保持接口的一致性。
好的接口不是泛泛而谈功能，
不是任意地扩展参数，而是在屏蔽细节的基础上，完成具体而明确的行为。
比如接口是阻塞或是非阻塞的，出现错误时是返回错误码还是抛异常，
这些都是要明确的，而接口的大O值是O(N)或O(logN)，则是偏重实现层面。
其它的里氏替换原则说的是怎么界定基类和子类，依赖倒置则是说
细节要依赖于抽象，抽象不应依赖于细节。相比之下都是更具体的操作手法。</p>
<p>因此只要能实现OCP原则的语言，就完成了最核心的功能，都可以称之为OO语言。
C++实现OCP的机制是多态，但多态从语法层面是强依赖于继承的，
而C++的继承又只有实现继承，
因此多数人会自然地关注类的特性，偏偏C++的类有
public、protected、private关键字，且非常直观易懂，导致很多人在入门的时候
把认知的重心放在封装上。加上对象二字又和现实世界中的具体的实体对应，
这又强化了面向对象即封装的认识。其实很多动态语言，根本没有提供
封装的语法关键字，但不妨碍很优雅地实现OCP。</p>
<p>很多教科书在讲授面向对象时，
都用鸟能飞，于是继承自鸟的子类大雁也能飞，但一碰到企鹅就傻眼了。
我反倒奇怪，为什么很少有教科书拿Duck Typing作例子，如果一种东西能飞，
那它就是一只抽象的鸟，即便它其实是飞机，又有什么关系呢，
反正它满足了我们对于飞的期望，而且比鸟飞得更好。</p>
<p>以上讲了面向对象中最核心的概念是开闭原则，接下来结合我的经历说说这个原则的具体应用。</p>
<p>先说句题外话，在面向对象思想发展之前，讨论更多的是结构化编程思想。
今天已经很少有人提了，但是并不代表结构化编程思想过时，
而是两者的出现时代，要解决的问题不同。
结构化编程的年代，代码规模还很小，也没有什么代码规范，
更多的时候都是用汇编甚至机器码写程序，因此怎么抽象机器，
怎么规范化地表达程序，是当时重点要解决的问题。
而随着结构化思想被众人接受，程序规范化提高，
给大规模编程提供了基础设施，使得多人合作完成程序成为可能。
这时怎样更好地配合，怎样使软件更稳定，成为了那个时代的痛点(今天依然是)。
当人们为解决这些问题时，才催生了面向对象思想。</p>
<p>因为多人配合，互相之间不会去关注对方的实现细节，这时接口就成了联系的纽带。
要让这个纽带好用，就要满足开闭原则所说的对扩展开放，对修改封闭。</p>
<p>比如一开始有这样一个接口：<code>int getVersion(void* ver);</code>。
这个接口被定下来的时候，ver指针指向的真实内容是<code>char*</code>，
一段类似"2.1.11.3.R"这样的字符串。为什么要用<code>void*</code>而不是<code>char*</code>呢？
据说是制定的时候为了扩展性，因为<code>void*</code>可以转换成任何类型嘛。</p>
<p>果然没过多久，需求就来了，原始版本只能表示软件版本号，
可现在需求要SVN版本号，怎么办，扩展呗。把参数改成</p>
<p>因为结构体的第一个字段也是<code>char*</code>，所以不影响即有代码。
而且能通过<code>void*</code>强制转换得到想要的结果。看，当初使用<code>void*</code>多么明智啊。</p>
<p>可是这样真的对吗，是不是还漏考虑了另一种情况，
即使用者已经按struct来使用了，可是因为一些原因，
提供实现的人也许漏实现了或者提供错了版本，这时svnVer尽管也能取到值，
可是这个值所指向的内存，根本不是期望的内容啊。
更正确的做法，是一开始就把接口定义成<code>int getVersion(struct Version * ver);</code>
而结构体的定义类似</p>
<p>则使用者在扩展后，即使库没有更新，因为取到的内存值就是0。
而0显然是个非法的SVN版本号，使用者可以因此做到区分。</p>
<p>那么是不是增加保留位就可以了呢？不够，如何正确地扩展保留位，
也是有技巧的。考虑这样一个场景：原来的产品都有NAT穿透功能，
因为产品细分做CostDown，为了做到市场区分，部分产品从软件层面屏蔽了该功能。
可是界面需要根据是否有NAT来配置界面啊，那就继续扩展吧。
增加一个<code>int8_t hasNAT</code>？可是这样就不对了。因为原来的产品其实是有NAT的，
按hasNAT的意思，原有产品都得修改代码这样，这就增加了无谓的工作量，
所以正确的扩展应该是noNAT，这样才是对修改关闭的。说来简单的一个小技巧，
可从我的经历来看，却很少有人注意到。</p>
<p>在我刚工作不久的时候，我的主管和我说：
在做大型项目的时候，一定要有面向对象思想。
那时我的对面向对象还停留在类、封装这些概念上，
并没有体会出面向对象在大型项目里有什么应用，
今天想来，也许就是想说在大型项目中接口的重要程度吧。</p>
</div>
<div class="post-meta meta-tags">
没有标签
</div>
</article>
</div>
<footer id=footer>
<div>
&copy; 2021 <a href>蛙二的思考 By </a>
</div>
<br>
<div>
<div class=github-badge>
<a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
</div>
<div class=github-badge>
<a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">蛙二</span></a>
</div>
<div class=github-badge>
<a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
</div>
</div>
</footer>
<script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script>
</div>
<div id=secondary>
<section class=widget>
<form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1>
<input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch>
<button type=submit class="submit icon-search"></button>
</form>
</section>
<section class=widget>
<h3 class=widget-title>最近文章</h3>
<ul class=widget-list>
<li>
<a href=/post/211218/ title=内存使用的观察和理解>内存使用的观察和理解</a>
</li>
<li>
<a href=/post/211115/ title=搭建最小化的Linux系统>搭建最小化的Linux系统</a>
</li>
<li>
<a href=/post/211102/ title=几种语言的包加载和管理机制>几种语言的包加载和管理机制</a>
</li>
<li>
<a href=/post/211016/ title=以太和IP网之外的一些网络>以太和IP网之外的一些网络</a>
</li>
<li>
<a href=/post/210901/ title=对昼伏夜出和朝九晚五两个技战法的分析>对昼伏夜出和朝九晚五两个技战法的分析</a>
</li>
<li>
<a href=/post/210729/ title=git的远程访问辨析>git的远程访问辨析</a>
</li>
<li>
<a href=/post/210721/ title=PySpark分析>PySpark分析</a>
</li>
<li>
<a href=/post/210614/ title=erlang和其上的扩展语言>erlang和其上的扩展语言</a>
</li>
<li>
<a href=/post/210613/ title=lisp编程与结构化思想>lisp编程与结构化思想</a>
</li>
<li>
<a href=/post/210611/ title=理解shell的换行和打印>理解shell的换行和打印</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/categories/>分类</a></h3>
<ul class=widget-list>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/tags/>标签</a></h3>
<div class=tagcloud>
</div>
</section>
<section class=widget>
<h3 class=widget-title>其它</h3>
<ul class=widget-list>
<li><a href=index.xml>文章 RSS</a></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</body>
</html>